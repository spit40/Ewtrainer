<!doctype html><meta name=viewport content="width=device-width,initial-scale=1">
<title>EW Compass Trainer</title>
<style>
:root{
  --bg:#0a0a0a; --ring:#555; --tick:#777; --line:#6a6a6a;
  --east:rgba(255,180,40,.08); --west:rgba(110,150,255,.10); --ns:rgba(255,255,255,.03);
  --ok:#0f0; --bad:#f33; --text:#fff;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.wrap{height:100%;display:flex;align-items:center;justify-content:center}
.compass{position:relative;width:92vmin;height:92vmin;border-radius:50%;border:5px solid var(--ring);overflow:hidden}
.ticks{position:absolute;inset:0;opacity:.5;pointer-events:none}
.frame{position:absolute;inset:0;transform-origin:50% 50%} /* rotates with arrow */
.q{position:absolute;width:50%;height:50%;transition:background .12s}
#qT{top:0;left:25%;background:var(--ns)}
#qB{bottom:0;left:25%;background:var(--ns)}
#qL{top:25%;left:0;background:var(--west)}
#qR{top:25%;right:0;background:var(--east)}
.flash-ok{background:var(--ok)!important}.flash-bad{background:var(--bad)!important}
.diag{position:absolute;left:50%;top:50%;width:140%;height:0;border-top:2px solid var(--line);transform-origin:center;pointer-events:none}
#d1{transform:translate(-50%,-50%) rotate(45deg)}#d2{transform:translate(-50%,-50%) rotate(-45deg)}
.prompt{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:11vmin;font-weight:800;letter-spacing:.04em}
#arrow{position:absolute;inset:0;transform-origin:50% 50%;opacity:.8;filter:drop-shadow(0 0 6px rgba(0,0,0,.5));pointer-events:none}
</style>

<div class="wrap">
  <div id="comp" class="compass" aria-label="Compass">
    <!-- ticks -->
    <svg class="ticks" viewBox="0 0 100 100" aria-hidden="true"><g transform="translate(50,50)" stroke="#777" stroke-linecap="round">
      <g stroke-width="1.2">
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(0)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(45)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(90)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(135)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(180)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(225)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(270)"/>
        <line x1="0" y1="-47" x2="0" y2="-40" transform="rotate(315)"/>
      </g>
      <g stroke-width=".7">
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(15)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(30)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(60)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(75)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(105)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(120)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(150)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(165)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(195)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(210)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(240)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(255)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(285)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(300)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(330)"/>
        <line x1="0" y1="-46" x2="0" y2="-42" transform="rotate(345)"/>
      </g>
    </g></svg>

    <!-- rotating frame (quadrants + X) -->
    <div id="frame" class="frame">
      <div id="qT" class="q"></div><div id="qB" class="q"></div>
      <div id="qL" class="q"></div><div id="qR" class="q"></div>
      <div id="d1" class="diag"></div><div id="d2" class="diag"></div>
    </div>

    <!-- arrow -->
    <svg id="arrow" viewBox="-50 -50 100 100" aria-hidden="true">
      <rect x="-1.2" y="-36" width="2.4" height="36" rx="1.2" fill="#fff"/>
      <polygon points="0,-44 4.2,-36  -4.2,-36" fill="#fff"/>
    </svg>

    <div id="prompt" class="prompt">?</div>
  </div>
</div>

<script>
let maxRot=18, cap=170, step=6, angle=0, current="", ready=false;
const comp=document.getElementById('comp'),
      frame=document.getElementById('frame'),
      arrow=document.getElementById('arrow'),
      promptEl=document.getElementById('prompt'),
      qT=document.getElementById('qT'),
      qB=document.getElementById('qB'),
      qL=document.getElementById('qL'),
      qR=document.getElementById('qR'),
      quads={T:qT,B:qB,L:qL,R:qR};

function randSigned(m){const mag=Math.random()*m;return(Math.random()<.5?-1:1)*mag;}
function setHeading(a){frame.style.transform='rotate('+a+'deg)';arrow.style.transform='rotate('+a+'deg)';}
function clearFlashes(){for(const q of Object.values(quads)) q.classList.remove('flash-ok','flash-bad');}
function angleToQuad(a){a=(a%360+360)%360;
  if(a>=45&&a<135)return'R'; if(a>=135&&a<225)return'B';
  if(a>=225&&a<315)return'L'; return'T';
}

function nextRound(){
  current=Math.random()<.5?'East':'West';
  promptEl.textContent=current.toUpperCase();
  angle=randSigned(maxRot);
  setHeading(angle);
  ready=true;
}

function expectedQuad(){return(current==='East')?'R':'L';}

function tapToQuad(x,y){
  const r=comp.getBoundingClientRect();
  const cx=r.left+r.width/2, cy=r.top+r.height/2;
  const dx=x-cx, dy=y-cy;
  let deg=(Math.atan2(dy,dx)*180/Math.PI+90+360)%360;
  let adj=(deg-angle+360)%360;
  return angleToQuad(adj);
}

function handlePick(q){
  if(!ready)return; ready=false;
  const exp=expectedQuad();
  const ok=(q===exp);
  quads[q].classList.add(ok?'flash-ok':'flash-bad');
  setTimeout(()=>{clearFlashes();if(maxRot<cap)maxRot=Math.min(cap,maxRot+step);nextRound()},360);
}

comp.addEventListener('click',e=>handlePick(tapToQuad(e.clientX,e.clientY)));
comp.addEventListener('touchstart',e=>{const t=e.touches&&e.touches[0];if(t)handlePick(tapToQuad(t.clientX,t.clientY));},{passive:true});
nextRound();
</script>
